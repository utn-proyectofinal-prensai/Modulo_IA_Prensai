# ğŸš€ MÃ³dulo IA Prensai - Interpretador de Noticias

MÃ³dulo interpretador de noticias para transformar en data estructurada mediante IA.

## ğŸ“‹ DescripciÃ³n General

Este mÃ³dulo procesa noticias de medios digitales y las clasifica automÃ¡ticamente usando Inteligencia Artificial (Ollama y GPT-4) para extraer informaciÃ³n estructurada como tipo de publicaciÃ³n, temas, valoraciÃ³n, menciones y mÃ¡s.

## ğŸ—ï¸ Arquitectura

### Componentes Principales
- **API Flask** (`api_flask.py`) - Servidor principal con endpoints REST
- **Ollama Utils** (`O_Utils_Ollama.py`) - IntegraciÃ³n con modelos locales Ollama
- **GPT Utils** (`O_Utils_GPT.py`) - IntegraciÃ³n con OpenAI GPT-4
- **Utils Generales** (`Z_Utils.py`) - Funciones auxiliares y scraping

### Endpoints Disponibles
- `POST /procesar-noticias` - Procesa noticias individuales
- `POST /procesar-noticias-export-excel` - Procesa y exporta a Excel
- `GET /health` - VerificaciÃ³n de estado
- `GET /logs` - Consulta de logs
- `POST /config/*` - ConfiguraciÃ³n del sistema (requiere autenticaciÃ³n)

## ğŸš€ CÃ³mo Levantar el Sistema

### 1. Levantar la API
```bash
cd /ruta/al/proyecto
source venv/bin/activate
python api_flask.py
```
La API estarÃ¡ disponible en `http://localhost:5000`

### 2. (Opcional) Hacer PÃºblica con ngrok
```bash
# En otra terminal
ngrok http 5000
```
ObtendrÃ¡s una URL pÃºblica como: `https://abc123.ngrok-free.app`

## ğŸ” AutenticaciÃ³n

### Endpoints Protegidos
Los endpoints de configuraciÃ³n (`/config/*`) requieren autenticaciÃ³n por token.

**Token:** `prensai-config-2025`

### Uso del Token
```bash
curl -X POST https://tu-url.ngrok.io/config/gpt-active \
  -H "X-API-Key: prensai-config-2025" \
  -H "Content-Type: application/json" \
  -d '{"gpt_active": true}'
```

## ğŸ“Š Uso de la API

### Procesar Noticias
```bash
curl -X POST https://tu-url.ngrok.io/procesar-noticias-export-excel \
  -H "Content-Type: application/json" \
  -d '{
    "urls": ["https://ejemplo.com/noticia1"],
    "temas": ["Cultura", "Actividades"],
    "menciones": ["Gabriela Ricardes"],
    "ministro_key_words": ["Gabriela Ricardes", "Ministra de Cultura"],
    "ministerios_key_words": ["Ministerio de Cultura"]
  }'
```

### Activar/Desactivar GPT
```bash
# Activar GPT
curl -X POST https://tu-url.ngrok.io/config/gpt-active \
  -H "X-API-Key: prensai-config-2025" \
  -H "Content-Type: application/json" \
  -d '{"gpt_active": true}'

# Desactivar GPT (usar Ollama)
curl -X POST https://tu-url.ngrok.io/config/gpt-active \
  -H "X-API-Key: prensai-config-2025" \
  -H "Content-Type: application/json" \
  -d '{"gpt_active": false}'
```

## ğŸ§ª Testing

### Scripts AutomÃ¡ticos
El proyecto incluye scripts de testing que detectan automÃ¡ticamente si ngrok estÃ¡ activo:

- `./Testing/Curls/curl_activar_gpt.sh` - Activa/desactiva GPT
- `./Testing/Curls/curl_es_declaracion.sh` - Test de declaraciones
- `./Testing/Curls/curl_origin.sh` - Test exhaustivo con mÃºltiples URLs

### Ejecutar Tests
```bash
chmod +x Testing/Curls/*.sh
./Testing/Curls/curl_activar_gpt.sh
```

## ğŸ”§ ConfiguraciÃ³n

### Variables de Entorno
- `OPENAI_API_KEY` - Clave de API de OpenAI (para GPT-4)
- `OLLAMA_BASE_URL` - URL base de Ollama (por defecto: localhost:11434)

### ConfiguraciÃ³n en Runtime
- **LÃ­mite de texto:** Configurable via API
- **Modelo de IA:** Alterna entre Ollama y GPT-4
- **Logs:** Consultables via endpoint

## ğŸ“ Estructura del Proyecto

```
Modulo_IA_Prensai/
â”œâ”€â”€ api_flask.py              # API principal
â”œâ”€â”€ O_Utils_Ollama.py         # Utilidades Ollama
â”œâ”€â”€ O_Utils_GPT.py           # Utilidades GPT
â”œâ”€â”€ Z_Utils.py               # Utilidades generales
â”œâ”€â”€ Testing/                 # Scripts de testing
â”‚   â””â”€â”€ Curls/              # Scripts curl automÃ¡ticos
â”œâ”€â”€ Data_Results/            # Archivos Excel generados
â””â”€â”€ venv/                   # Entorno virtual Python
```

## ğŸŒŸ CaracterÃ­sticas Principales

- **Doble modelo de IA:** Ollama (local) + GPT-4 (cloud)
- **Fallback automÃ¡tico:** Si GPT falla, usa Ollama
- **Scraping robusto:** Con reintentos y manejo de errores
- **ExportaciÃ³n a Excel:** Resultados estructurados
- **AutenticaciÃ³n por token:** Endpoints sensibles protegidos
- **DetecciÃ³n automÃ¡tica de ngrok:** Scripts se adaptan automÃ¡ticamente

## ğŸ“ Soporte

Para dudas o problemas, revisar los logs via endpoint `/logs` o consultar la documentaciÃ³n del cÃ³digo. 
